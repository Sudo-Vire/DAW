<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dibujar Graficas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }

        #mainContainer {
            width: 80%;
            padding: 20px;
            margin: 40px auto;
            background-color: #ffffff;
            padding: 20px;
            border: 1px solid #dddddd;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 800px; /* establece un máximo de ancho */
            min-height: 600px; /* establece un máximo de alto */
            overflow: auto;
        }

        #titulo {
            text-align: center;
            margin-bottom: 20px;
        }

        #graficaCanvas {
            border: 1px solid #000000;
            margin-bottom: 20px;
        }

        #inputsContainer {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-bottom: 20px;
        }

        #inputFormula, #inputEscala {
            width: 200px;
            height: 40px;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #cccccc;
            border-radius: 5px;
        }

        #botonDibujar {
            width: 200px;
            height: 60px;
            margin-bottom: 10px;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: #ffffff;
            border: 1px solid #cccccc;
            cursor: pointer;
        }

        #botonDibujar:hover {
            background-color: #3e8e41;
        }

        @media (max-width: 800px) {
            #mainContainer {
                min-width: 80%; 
            }

            #inputFormula, #inputEscala, #botonDibujar {
                width: 33%; 
            }

            #graficaCanvas {
                width: 80%; 
            }
        }
    </style>
    <script>
        window.onload = function() {
            const mainContainer = document.createElement('div');
            mainContainer.id = 'mainContainer';
            document.body.appendChild(mainContainer);

            const titulo = document.createElement('h1');
            titulo.id = 'titulo';
            titulo.textContent = "Dibujar gráficas";
            mainContainer.appendChild(titulo);

            const canvas = document.createElement('canvas');
            canvas.id = 'graficaCanvas';
            canvas.width = 500;
            canvas.height = 500;
            mainContainer.appendChild(canvas);

            const inputsContainer = document.createElement('div');
            inputsContainer.id = 'inputsContainer';
            mainContainer.appendChild(inputsContainer);

            const inputFormula = document.createElement('input');
            inputFormula.id = 'inputFormula';
            inputFormula.type = 'text';
            inputFormula.value = 'x+3';
            inputsContainer.appendChild(inputFormula);

            const inputEscala = document.createElement('input');
            inputEscala.id = 'inputEscala';
            inputEscala.type = 'number';
            inputEscala.value = '100';
            inputsContainer.appendChild(inputEscala);

            const botonDibujar = document.createElement('input');
            botonDibujar.id = 'botonDibujar';
            botonDibujar.type = 'button';
            botonDibujar.value = 'Dibujar';
            inputsContainer.appendChild(botonDibujar);

            function dibujarGrafica() {
                const formula = document.getElementById('inputFormula').value || 'x+3';
                const Escala = parseFloat(document.getElementById('inputEscala').value) || 100;

                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.strokeStyle = '#84847b';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(0, 250); 
                ctx.lineTo(500, 250); 
                ctx.moveTo(250, 0); 
                ctx.lineTo(250, 500); 
                ctx.stroke();

                ctx.lineWidth = 1;
                for (let i = -Math.floor(canvas.width / (Escala / 10)); i <= Math.floor(canvas.width / (Escala / 10)); i++) {
                    const PosX = 250 + i * Escala / 10; 
                    ctx.beginPath();
                    ctx.moveTo(PosX, 245);
                    ctx.lineTo(PosX, 255); 
                    ctx.stroke();
                }

                for (let i = -Math.floor(canvas.height / (Escala / 10)); i <= Math.floor(canvas.height / (Escala / 10)); i++) {
                    const PosY = 250 - i * Escala / 10; 
                    ctx.beginPath();
                    ctx.moveTo(245, PosY);
                    ctx.lineTo(255, PosY); 
                    ctx.stroke();
                }

                ctx.strokeStyle = '#ff0000';
                ctx.lineWidth = 2;
                ctx.beginPath();
                let UltimaX, UltimaY;

                for (let x = -1000; x <= 1000; x += 0.2) { 
                    const evalFormula = formula.replace(/x/g, `(${x})`).replace(/\^/g, '**');
                    const y = eval(evalFormula);
                    const X = 250 + x * Escala / 10;
                    const Y = 250 - y * Escala / 10;

                    if (x === -1000) {
                        ctx.moveTo(X, Y);
                    } else {
                        ctx.lineTo(X, Y);
                    }

                    if (Y < 0 || Y > canvas.height) {
                        const InterseccionY = (Y < 0) ? 0 : canvas.height;
                        const Pendiente = (Y - UltimaY) / (X - UltimaX);
                        const InterseccionX = UltimaX + (InterseccionY - UltimaY) / Pendiente;

                        ctx.lineTo(InterseccionX, InterseccionY);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(InterseccionX, InterseccionY);
                    }

                    UltimaX = X;
                    UltimaY = Y;
                }
                ctx.stroke();
                ctx.fillStyle = '#000000'; 
                ctx.font = '16px Arial'; 
                ctx.fillText(`y = ${formula}`, 10, canvas.height - 10); 
                ctx.fillStyle = '#000000';
                ctx.font = '16px Arial'; 
                ctx.fillText('x', canvas.width - 30, 265); 
                ctx.fillText('y', 235, 30); 
            }

            dibujarGrafica();
        }
    </script>
</head>
</html>
