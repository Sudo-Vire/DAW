<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dibujar Graficas</title>
    <script>
        window.onload = function() {
            const mainContainer = document.createElement('div');
            document.body.appendChild(mainContainer);

            const titulo = document.createElement('h1');
            titulo.textContent = "Dibujar gr√°ficas";
            mainContainer.appendChild(titulo);

            const canvas = document.createElement('canvas');
            canvas.id = 'graficaCanvas';
            canvas.width = 500;
            canvas.height = 500;
            canvas.style.border = '1px solid #000000';
            mainContainer.appendChild(canvas);

            const container = document.createElement('div');
            container.style.position = 'absolute';
            container.style.top = '80px';
            container.style.right = '210px'; 
            container.style.display = 'flex';
            container.style.flexDirection = 'column';
            document.body.appendChild(container);

            const inputFormula = document.createElement('input');
            inputFormula.type = 'text';
            inputFormula.id = 'inputFormula';
            inputFormula.value = 'x+3';
            inputFormula.style.marginBottom = '10px';
            inputFormula.style.height = '40px';
            inputFormula.style.borderRadius = '5px';
            inputFormula.style.borderWidth = '1px';
            container.appendChild(inputFormula);

            const inputEscala = document.createElement('input');
            inputEscala.type = 'number';
            inputEscala.id = 'inputEscala';
            inputEscala.value = '100';
            inputEscala.style.marginBottom = '10px';
            inputEscala.style.height = '40px';
            inputEscala.style.borderRadius = '5px';
            inputEscala.style.borderWidth = '1px';
            container.appendChild(inputEscala);

            const botonDibujar = document.createElement('input');
            botonDibujar.type = 'button';
            botonDibujar.value = 'Dibujar';
            botonDibujar.onclick = dibujarGrafica;
            botonDibujar.style.height = '40px';
            botonDibujar.style.borderRadius = '5px';
            botonDibujar.style.borderWidth = '1px';
            container.appendChild(botonDibujar);

            function dibujarGrafica() {
                const formula = document.getElementById('inputFormula').value || 'x+3';
                const Escala = parseFloat(document.getElementById('inputEscala').value) || 100;

                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.strokeStyle = '#84847b';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(0, 250); 
                ctx.lineTo(500, 250); 
                ctx.moveTo(250, 0); 
                ctx.lineTo(250, 500); 
                ctx.stroke();

                ctx.lineWidth = 1;
                for (let i = -Math.floor(canvas.width / (Escala / 10)); i <= Math.floor(canvas.width / (Escala / 10)); i++) {
                    const PosX = 250 + i * Escala / 10; 
                    ctx.beginPath();
                    ctx.moveTo(PosX, 245);
                    ctx.lineTo(PosX, 255); 
                    ctx.stroke();
                }

                for (let i = -Math.floor(canvas.height / (Escala / 10)); i <= Math.floor(canvas.height / (Escala / 10)); i++) {
                    const PosY = 250 - i * Escala / 10; 
                    ctx.beginPath();
                    ctx.moveTo(245, PosY);
                    ctx.lineTo(255, PosY); 
                    ctx.stroke();
                }

                ctx.strokeStyle = '#ff0000';
                ctx.lineWidth = 2;
                ctx.beginPath();
                let UltimaX, UltimaY;

                for (let x = -1000; x <= 1000; x += 0.2) { 
                    const evalFormula = formula.replace(/x/g, `(${x})`).replace(/\^/g, '**');
                    const y = eval(evalFormula);
                    const X = 250 + x * Escala / 10;
                    const Y = 250 - y * Escala / 10;

                    if (x === -1000) {
                        ctx.moveTo(X, Y);
                    } else {
                        ctx.lineTo(X, Y);
                    }

                    if (Y < 0 || Y > canvas.height) {
                        const InterseccionY = (Y < 0) ? 0 : canvas.height;
                        const Pendiente = (Y - UltimaY) / (X - UltimaX);
                        const InterseccionX = UltimaX + (InterseccionY - UltimaY) / Pendiente;

                        ctx.lineTo(InterseccionX, InterseccionY);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(InterseccionX, InterseccionY);
                    }

                    UltimaX = X;
                    UltimaY = Y;
                }
                ctx.stroke();
                ctx.fillStyle = '#000000'; 
                ctx.font = '16px Arial'; 
                ctx.fillText(`y = ${formula}`, 10, canvas.height - 10); 
                ctx.fillStyle = '#000000';
                ctx.font = '16px Arial'; 
                ctx.fillText('x', canvas.width - 30, 265); 
                ctx.fillText('y', 235, 30); 
            }

            dibujarGrafica();
        }
    </script>
</head>
<body>
</body>
</html>